# 前端性能优化

- [前端性能优化小结（面试干货）](https://zhuanlan.zhihu.com/p/115047733)

## 首屏白屏进行优化

### 1. 资源加载优化

- **资源压缩**：压缩 HTML、CSS 和 JavaScript 文件，减少文件大小。
- **图片优化**：使用合适的图片格式（如 WebP），压缩图片大小，使用响应式图片。
- **代码拆分**：使用代码分割（Code Splitting）技术，按需加载 JavaScript 代码。将项目代码拆分成多个小块，按需加载。这样可以减少首次加载时需要下载的文件大小，加快页面渲染速度。Webpack、Parcel 等打包工具都提供了代码拆分的功能，可以根据路由、组件等动态加载模块。
- **延迟加载**：对于非首屏内容的资源（如图片、视频等）使用懒加载（Lazy Loading）技术。Vue 的路由懒加载和 React 的动态 import 都是实现懒加载的常见方式。
- **预加载（Preloading）：** 使用 `<link rel="preload">` 标签在 HTML 中预加载关键资源，如脚本、样式、字体、图片等。它允许浏览器在渲染页面之前加载这些资源，以加快页面加载速度。

```html
<link
  rel="preload"
  href="style.css"
  as="style"
/>
<link
  rel="preload"
  href="script.js"
  as="script"
/>
```

### 2. 提高渲染速度

- **服务端渲染（SSR）**：使用 Next.js 或 Nuxt.js 等框架进行服务端渲染，将部分渲染工作放在服务器端完成，减少客户端的渲染压力。
- **预渲染**：使用静态站点生成器（如 Gatsby、Next.js）预渲染页面内容，减少首屏渲染时间。
- **骨架屏**：在资源加载完成前显示骨架屏，提升用户体验。

### 3. 网络优化

- **使用 CDN**：将静态资源托管到 CDN 上，减少资源加载时间。
- **HTTP/2**：利用 HTTP/2 多路复用特性，提高资源加载速度。
- **DNS 预解析**：提前解析外部资源的 DNS，减少 DNS 解析时间。
- **缓存策略：** 设置合适的缓存策略，利用浏览器缓存机制来提高页面加载速度。可以使用 HTTP 头中的 Cache-Control、Expires 等字段来控制缓存。

### 4. 代码优化

- **减少重排和重绘**：优化 CSS 和 JavaScript 代码，减少浏览器重排（Reflow）和重绘（Repaint）。
- **异步加载 JavaScript**：将非关键 JavaScript 脚本异步加载（如使用 `async` 和 `defer` 属性）。
- **CSS 优化**：尽量将关键 CSS 内联到 HTML 中，减少页面首次渲染时间。

### 5. 性能监控和分析

- **使用 Lighthouse**：使用 Google Lighthouse 工具进行性能分析，获取优化建议。
- **使用 Web Vitals**：监控和分析核心 Web 指标（如 LCP、FID、CLS），找出性能瓶颈。

通过以上方法，可以有效减少首屏白屏时间，提升用户体验。

## 内容分发网络 CDN

CDN 是内容分发网络（Content Delivery Network）的缩写，是一种用于加速网络内容传输的技术架构。

CDN 的基本原理是将站点的静态资源（如图片、样式表、脚本文件等）缓存在分布在全球各地的服务器节点上，使用户可以从离其最近的节点获取所需的资源，从而减少网络延迟和提高页面加载速度。

## 如何避免

CSS

- 避免使用 table 布局。
- 尽可能在 DOM 树的最末端改变 class。
- 避免设置多层内联样式。
- 将动画效果应用到 position 属性为 absolute 或 fixed 的元素上。
- 避免使用 CSS 表达式（例如：calc()）。

Javascript

- 避免频繁操作样式，最好一次性重写 style 属性，或者将样式列表定义为 class 并一次性更改 class 属性。
- 避免频繁操作 DOM，创建一个 documentFragment，在它上面应用所有 DOM 操作，最后再把它添加到文档中。
- 也可以先为元素设置 display: none，操作结束后再把它显示出来。因为在 display 属性为 none 的元素上进行的 DOM 操作不会引发回流和重绘。
- 避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来。
- 对具有复杂动画的元素使用绝对定位，使它脱离文档流，否则会引起父元素及后续元素频繁回流。

## 图片懒加载

## 事件委托

1. 大量减少内存占用，减少事件注册。
2. 新增元素实现动态绑定事件

## 渲染完成后的页面交互优化

- 防抖（debounce）/节流（throttle）

## Vue 性能优化建议

- Vue 应用运行时性能优化措施

- 引入生产环境的 Vue 文件

  - 使用单文件组件预编译模板
  - 提取组件的 CSS 到单独到文件
  - 利用 Object.freeze()提升性能
  - 扁平化 Store 数据结构
  - 合理使用持久化 Store 数据
  - 组件懒加载

- Vue 应用加载性能优化措施

- - 服务端渲染 / 预渲染
  - 组件懒加载

其他方面优化补充

- webpack 模块打包和 JavaScript 压缩（如 gzip 压缩）
- 利用 CDN
- 按需加载资源
- 在使用 DOM 操作库时用上 array-ids
- 缓存优化
- 避免重定向
- 启用 HTTP/2
- 应用性能分析
- 使用负载均衡方案
- 为了更快的启动时间考虑一下同构
- 使用索引加速数据库查询
- 使用更快的转译方案
- 避免或最小化 JavaScript 和 CSS 的使用而阻塞渲染
- 用于未来的一个建议：使用 service workers + 流
- 图片编码优化，尽量使用 svg 和字体图标
