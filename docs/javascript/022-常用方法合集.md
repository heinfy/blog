# 001-常用方法

## 获取过去一周的时间

```js
const arr = [...Array(7).keys()].map(days => new Date(Date.now() - 86400000 * days));

console.log(arr);
```

## 生成随机 ID

```js
const codeId = Math.random().toString(36).substring(2);
```

## 获取 URL 的查询参数

```js
// 模拟 url，如：`?foo=bar&baz=bing`
const url = '?page=smqd%2Fuser%2FevalFill&channelType=CKJKX&orderId=&cardticketId=T363503';

let object = {};

// location.search.replace(/([^?&=]+)=([^&]+)/g, (_, k, v) => object[k] = v)
url.replace(/([^?&=]+)=([^&]+)/g, (_, k, v) => (object[k] = v));

console.log(object);
```

## 4;本地时间

```js
const now = new Date().toLocaleString().slice(0);
// const now = new Date().toLocaleString().slice(9, 19)
console.log(now);
```

## 生成随机十六进制代码（生成随机颜色）

```js
const color =
  '#' +
  Math.floor(Math.random() * 0xffffff)
    .toString(16)
    .padEnd(6, '0');

console.log(color);
```

## 公倍数问题

```js
// 找到 1 ~ 100 中 3的倍数 和 5的倍数
for (i = 0; ++i < 101; console.log(i % 5 ? f || i : f + '5的倍数')) f = i % 3 ? '' : '3的倍数';
```

## 获取本月天数

```js
const date = new Date();
const year = date.getFullYear();
const month = date.getMonth() + 1;
const days = new Date(year, month, 0).getDate();
console.log(days);
```

## 数学计算精度

```js
export default class MathBase {
  // 加法
  add(...list) {
    return list.reduce(MathBase._add);
  }
  // 减法
  subtract(...list) {
    return list.reduce(MathBase._subtract);
  }
  // 乘法
  multiply(...list) {
    return list.reduce(MathBase._multiply);
  }
  // 除法
  divide(...list) {
    return list.reduce(MathBase._divide);
  }
  // 加法
  static _add(n, m) {
    const { F, S, T, l1, l2 } = MathBase.getInteger(n, m);
    return (F[0] * T + (F[1] * T) / Math.pow(10, l1) + S[0] * T + (S[1] * T) / Math.pow(10, l2)) / T;
  }
  // 减法
  static _subtract(n, m) {
    const { F, S, T, l1, l2 } = MathBase.getInteger(n, m);
    return (F[0] * T + (F[1] * T) / Math.pow(10, l1) - S[0] * T - (S[1] * T) / Math.pow(10, l2)) / T;
  }
  // 乘法
  static _multiply(n, m) {
    const { F, S, T, l1, l2 } = MathBase.getInteger(n, m);
    return ((F[0] * T + (F[1] * T) / Math.pow(10, l1)) * (S[0] * T + (S[1] * T) / Math.pow(10, l2))) / T / T;
  }
  // 除法
  static _divide(n, m) {
    const { F, S, T, l1, l2 } = MathBase.getInteger(n, m);
    return (F[0] * T + (F[1] * T) / Math.pow(10, l1)) / (S[0] * T + (S[1] * T) / Math.pow(10, l2));
  }
  static numToString(tempArray) {
    if (typeof tempArray === 'number') {
      return tempArray.toString();
    }
    return '0';
  }
  static handleNum(n) {
    n = n.toString();
    let temp = n.split('.');
    temp.push(temp[1].length);
    return temp;
  }
  static getInteger(n, m) {
    n = typeof n === 'string' ? n : MathBase.numToString(n);
    m = typeof m === 'string' ? m : MathBase.numToString(m);
    let F = n.indexOf('.') !== -1 ? MathBase.handleNum(n) : [n, 0, 0];
    let S = m.indexOf('.') !== -1 ? MathBase.handleNum(m) : [m, 0, 0];
    let l1 = F[2];
    let l2 = S[2];
    let L = Math.max(l1, l2);
    let T = Math.pow(10, L);
    return { F, S, T, l1, l2 };
  }
}
```

## 同步阻塞法实现 sleep 函数

```js
const sleep = delay => {
  const start = new Date().getTime();
  while (new Date().getTime() - start < delay) {
    continue;
  }
};
console.log('start ...');
sleep(3000);
console.log('end ...');
```

## 利用 new URL 解析 URL

```js
const parseURL = (url = '') => {
  const res = new URL(url);
  res.queryParams = key => {
    if (key) {
      return res.searchParams.get(key);
    }
    const params = {};
    const paramGroup = res.search.replace(/^\?/, '').split('&');
    paramGroup.forEach(param => {
      const [key, val] = param.split('=');
      params[key] = val;
    });
    return params;
  };
  return res;
};
let urlObject = parseURL('https://www.example.com/api/test?name=houfei&age=12');
console.log(urlObject.queryParams('name'));
console.log(urlObject.queryParams('age'));
```

## 行代码实现星级评分

```js
const getRate = (rate = 0) => '★★★★★☆☆☆☆☆'.slice(5 - rate, 10 - rate);
console.log(getRate(3));
```

## 用位运算提升效率

```js
// ｜ 取整
let num1 = 7;
num1 = num1 | 0;

// >> 取半
let num2 = 6;
num2 = num2 >> 1; // 3

// << 加倍
let num3 = 6;
num3 = num3 << 1; // 12

// ^ 交换值
let num4 = 10;
let num5 = 20;
num4 ^= num5;
num5 ^= num4;
num4 ^= num5; // num4 === 2, num5 === 1

// & 判断奇数
let num6 = 10;
let num7 = 11;
num6 & (1 === 1); // true
num7 & (1 === 1); // false

// ~ 判断是否存在
const data = '123456';
const key = '3';
const keyIsExist = !!~data.indexOf(key); // true

// 是否 2 的整数幂
const isPowerOf2 = num => (num & (num - 1)) === 0;
isPowerOf2(8); // true
isPowerOf2(7); // false
```

## 复制文本到剪切板

[`clipboard.js`](https://github.com/zenorocha/clipboard.js)

## 一行代码生成指定长度的数组

```js
const List = len => [...new Array(len).keys()];
console.log(List(10));
```

## 判断数据类型

```js
const type = data => {
  let toString = Object.prototype.toString;
  const dataType =
    data instanceof Element
      ? 'element' // 为了统一 DOM 节点类型输出
      : toString
          .call(data)
          .replace(/\[object\s(.+)\]/, '$1')
          .toLowerCase();
  return dataType;
};

console.log(
  type(123),
  type('abc'),
  type(true),
  type(null),
  type([1, 2, 3]),
  type({}),
  type(() => {})
);
```
